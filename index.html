<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400..900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.3/nouislider.min.css" />

  <title>index</title>
  <script type="module" crossorigin src="/pinball-board/assets/index-b47b8fa5.js"></script>
  <link rel="stylesheet" href="/pinball-board/assets/index-7f6de697.css">
</head>

<body>
      <div class="container-fluid p-0">
      <div class="scroller" id="scroller">
        <div class="drag" id="drag">
          <!-- board -->
          <div class="board p-0 position-relative" id="board">


            <!-- 上方閃光 -->
            <div class="bluelight" id="blueLight"></div>

            <!-- light flashing -->

            <ul class="d-flex mouseLight-wrap justify-content-center align-items-center m-0 p-0">
              <li
                class="mouseLight mouseLight1 mouseFlash rounded-circle d-flex align-items-center justify-content-center"
                id="mouse1">鼠</li>
              <li
                class="mouseLight mouseLight2 mouseFlash rounded-circle d-flex align-items-center justify-content-center"
                id="mouse2">來</li>
              <li
                class="mouseLight mouseLight3 mouseFlash rounded-circle d-flex align-items-center justify-content-center"
                id="mouse3">數</li>
              <li
                class="mouseLight mouseLight4 mouseFlash rounded-circle d-flex align-items-center justify-content-center"
                id="mouse4">趣</li>
            </ul>

            <div class="d-flex pointLight-container">
              <ul class="pointLight-wrap1 m-0">
                <li
                  class="pointLight pointLight15 timing-0 rounded-circle d-flex align-items-center justify-content-center fw-bold start-0"
                  id="pointLight15" data-ticket="8">15分</li>
                <li
                  class="pointLight pointLight20 timing-0 rounded-circle d-flex align-items-center justify-content-center fw-bold start-15"
                  id="pointLight20" data-ticket="5">20分</li>
                <li
                  class="pointLight pointLight25 timing-0 rounded-circle d-flex align-items-center justify-content-center fw-bold start-20"
                  id="pointLight25" data-ticket="3">25分</li>
                <li
                  class="pointLight pointLight30 timing-0 rounded-circle d-flex align-items-center justify-content-center fw-bold start-25"
                  id="pointLight30" data-ticket="2">30分</li>
              </ul>
              <ul class="pointLight-wrap2 m-0">
                <li
                  class="pointLight pointLight35 timing-15 rounded-circle d-flex align-items-center justify-content-center fw-bold start-55"
                  id="pointLight35" data-ticket="2">35分</li>
                <li
                  class="pointLight pointLight40 timing-15 rounded-circle d-flex align-items-center justify-content-center fw-bold start-65"
                  id="pointLight40" data-ticket="1">40分</li>
                <li
                  class="pointLight pointLight45 timing-15 rounded-circle d-flex align-items-center justify-content-center fw-bold start-70"
                  id="pointLight45" data-ticket="1">45分</li>
                <li
                  class="pointLight pointLight50 timing-15 rounded-circle d-flex align-items-center justify-content-center fw-bold start-30"
                  id="pointLight50" data-ticket="2">50分</li>
              </ul>
              <ul class="pointLight-wrap3 m-0">
                <li
                  class="pointLight pointLight55 timing-15 rounded-circle d-flex align-items-center justify-content-center fw-bold start-60"
                  id="pointLight55" data-ticket="2">55分</li>
                <li
                  class="pointLight pointLight60 timing-15 rounded-circle d-flex align-items-center justify-content-center fw-bold start-65"
                  id="pointLight60" data-ticket="4">60分</li>
                <li
                  class="pointLight pointLight65 timing-15 rounded-circle d-flex align-items-center justify-content-center fw-bold start-70"
                  id="pointLight65" data-ticket="6">65分</li>
                <li
                  class="pointLight pointLight70 timing-15 rounded-circle d-flex align-items-center justify-content-center fw-bold start-35"
                  id="pointLight70" data-ticket="10">70分</li>
              </ul>
              <ul class="pointLight-wrap4 m-0">
                <li
                  class="pointLight pointLight75 timing-0 rounded-circle d-flex align-items-center justify-content-center fw-bold start-55"
                  id="pointLight75" data-ticket="20">75分</li>
                <li
                  class="pointLight pointLight80 timing-0 rounded-circle d-flex align-items-center justify-content-center fw-bold start-50"
                  id="pointLight80" data-ticket="30">80分</li>
                <li
                  class="pointLight pointLight85 timing-0 rounded-circle d-flex align-items-center justify-content-center fw-bold start-45"
                  id="pointLight85" data-ticket="40">85分</li>
                <li
                  class="pointLight pointLight90 timing-0 rounded-circle d-flex align-items-center justify-content-center fw-bold start-40"
                  id="pointLight90" data-ticket="50">90分</li>
              </ul>
            </div>

            <!-- 資訊牆 -->
            <div class="information" id="information">
              <div class="gameNumber"><label for="result_score"></label><input type="text" id="result_score"
                  name="result_score" required minlength="1" maxlangth="20" size="20" />
              </div>
              <div class="ballNumber"><label for="result_ball"></label><input type="text" id="result_ball"
                  name="result_ball" required min="1" max="100" size="20" /></div>
              <div class="ticket"><label for="ticket"></label><input type="text" id="ticket" name="ticket" required
                  min="1" max="100" size="20" /></div>
              <div class="point"><label for="point"></label><input type="text" id="point" name="point" required min="1"
                  max="100" size="20" /></div>
              <!-- 資訊牆 end -->
            </div>
          </div>


          <!-- 娃娃機中間 -->
          <div class="row middle justify-content-center m-0 position-relative">
            <div class="middle-frame text-center p-0 ">
              <!-- <img class="middle-img" id="middleImg" src="https://bizlution.pingguoxingren.com:60081/camera/0/stream" /> -->
              <div id="viewer"><canvas width="400" height="480" style="background-color: rgb(13, 14, 27);"></canvas>
              </div>
              <img class="imgFalse" id="imgFalse" src="/pinball-board/assets/baby-ec42d771.jpg" style="display:none;" />
            </div>
            <!--拉桿 -->

            <!-- <a href="javascript:void(0)" id="" class="bar p-0">
              <div class="barControl" id="barControl"><img src="../assets/images/把手-長.svg" alt="把手" id="barImgLong"><img
                  src="../assets/images/把手-短.svg" alt="短把手" id="barImgShort"></div>
            </a> -->

          </div>

          <!-- 娃娃機下半部 -->
          <div class="handle position-relative p-0">
            <!-- 開始鈕 -->
            <div class="start" id="button_start_game">
              <!--原id為pressStart -->
              <div class="start-button"><a href="javascript:void(0)"><span style="font-size:8vw;" class="shinning"
                    id="startButtonSvg"><i class="fa-solid fa-circle-dot"></i></span></a>
              </div>
            </div>

            <!-- <div class="coin">
                <div class="coin-button"><a href="javascript:void(0)" id="button_insert_coin"><span
                      style="font-size:6vw; color: rgb(255, 119, 0)"><i class="fa-solid fa-coins"></i></span></a>
                </div>
              </div> -->

          </div>
          <!-- 娃娃機下半部 end-->

          <!-- 娃娃機API按紐 -->
          <!-- <div class="d-flex"> -->
          <!-- 投幣 -->
          <!-- <div class="insertCoin" style="display:none">
              <a href="javascript:void(0)" id="button_insert_coin"><span
                  style="font-size:6vw; color: rgb(255, 119, 0)"><i class="fa-solid fa-coins"></i></span>投幣</a>
            </div> -->
          <!-- 進球 -->
          <!-- <div class="ball-in">
              <a href="javascript:void(0)" id="button_game_action_shortcut_1"><span
                  style="font-size:6vw; color: rgb(255, 119, 0)"><i class="fa-solid fa-meteor"></i></span>進球</a>
            </div> -->

          <!-- 疊球 -->
          <!-- <div class="ball-overlap">
              <div class=""><a href="javascript:void(0)" id="button_game_action_shortcut_2"><span
                    style="font-size:6vw; color: rgb(0, 57, 123)"><i class="fa-solid fa-record-vinyl"></i></span>疊球</a>
              </div>
            </div> -->

          <!-- 擊發 -->
          <!-- <div class="ball-fired" id="button_game_action_shoot">
              <div class=""><a href="javascript:void(0)"><span style="font-size:6vw; color: rgb(0, 57, 123)"><i
                      class="fa-solid fa-crosshairs"></i></span>擊發</a>
              </div>
            </div> -->
          <!-- 拉桿 -->
          <!-- <div class="ball-pull">
              <div class="" id="button_game_action_pull"><a href="javascript:void(0)"><span
                    style="font-size:6vw; color: rgb(0, 57, 123)"><i class="fa-solid fa-fire"></i></span>往後拉</a>
              </div>
            </div> -->


          <!-- Bar noUiSlider-->
          <div class="example mt-4" id="example">
            <div id="slider-format"></div>
            <input title="Formatted number" id="input-format" style="display:none;">
          </div>

          <!-- script modal button -->
          <div class="row mt-4">
            <div class="col-6">
              <div class="row">
                <div class="col-6">
                  <button class="btn btn-primary btn-small" id="button_script_run">Run</button>
                  <button class="btn btn-primary btn-small" id="button_script_stop">Stop</button>
                  <button class="btn btn-primary btn-small" id="button_script_step">Step</button>
                  <button class="btn btn-primary btn-small" id="button_script_empty">Empty</button>
                </div>

                <div class="col-4">
                  <select class="form-control" id="script_file_select">
                  </select>
                </div>

                <div class="col-2">
                  <button class="btn btn-primary btn-small" id="button_script_load">Load</button>
                </div>
              </div>
              <br>
              <div class="row">
                <div class="col-12">
                  <textarea class="form-control" id="script_editor" rows="6" cols="50"></textarea>
                </div>
              </div>
            </div>
            <div class="col-6">
              <div class="row">
                <div class="col-2">
                  <button class="btn btn-primary btn-small" id="button_log_clear">Clear</button>
                </div>

                <div class="col-2">
                  <button class="btn btn-primary btn-small" id="button_log_copy">Copy</button>
                </div>

              </div>
              <br>
              <div class="row">
                <div class="col-12">
                  <textarea id="output" class="form-control" rows="6" cols="50" readonly=""></textarea>
                </div>
              </div>
            </div>
          </div>


          <!-- 輸入案件 -->
          <div>
            <input type="text" id="sec" value="0.5" style="width: 100px;">
          </div>
        </div>
        <!-- 娃娃機API按紐 end-->

        <!-- pull range button -->
        <!-- <div class="pullRangeButton d-flex justify-content-between">
            <a href="javascript:void(0)" id="button_game_action_pull04">
              <div><span style="font-size:6vw; color: rgb(141, 141, 141)"><i
                    class="fa-solid fa-tablet-button"></i></span>
                <span>0.4</span>
              </div>
            </a>
            <a href="javascript:void(0)" id="button_game_action_pull05" data-value="0.5">
              <div><span style="font-size:6vw; color:  rgb(141, 141, 141)"><i
                    class="fa-solid fa-tablet-button"></i></span>
                <span>0.5</span>
              </div>
            </a>
            <a href="javascript:void(0)" id="button_game_action_pull06" data-value="0.6">
              <div><span style="font-size:6vw; color: rgb(141, 141, 141)"><i
                    class="fa-solid fa-tablet-button"></i></span>
                <span>0.6</span>
              </div>
            </a>
            <a href="javascript:void(0)" id="button_game_action_pull07" data-value="0.7">
              <div><span style="font-size:6vw; color: rgb(141, 141, 141)"><i
                    class="fa-solid fa-tablet-button"></i></span><span>0.7</span>
              </div>
            </a>
            <a href="javascript:void(0)" id="button_game_action_pull08" data-value="0.8">
              <div><span style="font-size:6vw; color:  rgb(141, 141, 141)"><i
                    class="fa-solid fa-tablet-button"></i></span><span>0.8</span>
              </div>
            </a>
            <a href="javascript:void(0)" id="button_game_action_pull09" data-value="0.9">
              <div><span style="font-size:6vw; color:  rgb(141, 141, 141)"><i
                    class="fa-solid fa-tablet-button"></i></span><span>0.9</span>
              </div>
            </a>
            <a href="javascript:void(0)" id="button_game_action_pull10" data-value="1">
              <div><span style="font-size:6vw; color:  rgb(141, 141, 141)"><i
                    class="fa-solid fa-tablet-button"></i></span><span>1.0</span>
              </div>
            </a>
            <a href="javascript:void(0)" id="button_game_action_pull11" data-value="1.1">
              <div><span style="font-size:6vw; color:  rgb(141, 141, 141)"><i
                    class="fa-solid fa-tablet-button"></i></span><span>1.1</span>
              </div>
            </a>

            <a href="javascript:void(0)" id="button_game_action_pull12">
              <div><span style="font-size:6vw; color:  rgb(141, 141, 141)"><i
                    class="fa-solid fa-tablet-button"></i></span><span>1.2</span>
              </div>
            </a>

            <a href="javascript:void(0)" id="button_game_action_pull13">
              <div><span style="font-size:6vw; color:  rgb(141, 141, 141)"><i
                    class="fa-solid fa-tablet-button"></i></span><span>1.3</span>
              </div>
            </a>

            <a href="javascript:void(0)" id="button_game_action_pull14">
              <div><span style="font-size:6vw; color:  rgb(141, 141, 141)"><i
                    class="fa-solid fa-tablet-button"></i></span><span>1.4</span>
              </div>
            </a>

            <a href="javascript:void(0)" id="button_game_action_pull15">
              <div><span style="font-size:6vw; color:  rgb(141, 141, 141)"><i
                    class="fa-solid fa-tablet-button"></i></span><span>1.5</span>
              </div>
            </a>

          </div> -->
        <!-- pull range button end-->




        <div class="button-white"></div>

        <!-- 開機鈕 -->
        <div class="boot-module" style="display:none;">
          <p>開機</p>
          <div class="boot-button"><a href="javascript:void(0)" id="pressBoot"><span
                style="font-size:2rem; color: rgba(18, 211, 1, 0.662)"><i class="fa-solid fa-power-off"></i></span></a>
          </div>
        </div>

        <!-- 關機鍵 -->
        <div class="shutdown-module" style="display:none;">
          <p>關機</p>
          <div class="shutdown-button"><a href="javascript:void(0)" id="pressShutdown"><span
                style="font-size:2rem; color: rgba(0, 129, 215, 0.747)"><i class="fa-solid fa-power-off"></i></span></a>
          </div>
        </div>




        <!-- 計分API -->

        <!-- audio -->
        <!-- 開機音樂 -->
        <audio controls src="/pinball-board/assets/鼠來鼠趣開機音樂1-完整一小段.mp3" id="bootMusic1_1" style="display:none;"></audio>
        <audio controls src="/pinball-board/assets/鼠來鼠趣開機音樂1-完整一小段(不含前面).mp3" id="bootMusic1_2"
          style="display:none;"></audio>
        <audio controls src="/pinball-board/assets/鼠來鼠趣開機音樂1-完整一小段(不含前面).mp3" id="bootMusic1_3"
          style="display:none;"></audio>

        <audio controls src="/pinball-board/assets/鼠來鼠趣開機音樂2-完整一小段.mp3" id="bootMusic2_1" style="display:none;"></audio>
        <audio controls src="/pinball-board/assets/鼠來鼠趣開機音樂2-完整一小段(不含前面).mp3" id="bootMusic2_2"
          style="display:none;"></audio>
        <audio controls src="/pinball-board/assets/鼠來鼠趣開機音樂2-完整一小段(不含前面).mp3" id="bootMusic2_3"
          style="display:none;"></audio>

        <audio controls src="/pinball-board/assets/鼠來鼠趣開機音樂3-完整一小段.mp3" id="bootMusic3_1" style="display:none;"></audio>
        <audio controls src="/pinball-board/assets/鼠來鼠趣開機音樂3-完整一小段(不含前面).mp3" id="bootMusic3_2"
          style="display:none;"></audio>
        <audio controls src="/pinball-board/assets/鼠來鼠趣開機音樂3-完整一小段(不含前面).mp3" id="bootMusic3_3"
          style="display:none;"></audio>

        <!-- 投幣音樂 -->
        <audio controls src="/pinball-board/assets/投幣音樂.mp3" id="cointMusic" style="display:none;"></audio>

        <!-- 開始音樂 -->
        <audio controls src="/pinball-board/assets/開始音樂.mp3" id="startMusic" style="display:none;"></audio>

        <!-- 得分音樂1 -->
        <audio controls src="/pinball-board/assets/得分音樂1.mp3" id="playMusic1" style="display:none;"></audio>

        <!-- 得分音樂2 -->
        <audio controls src="/pinball-board/assets/得分音樂2.mp3" id="playMusic2" style="display:none;"></audio>

        <!-- 拉桿撞擊聲 -->
        <audio controls src="/pinball-board/assets/拉桿撞擊聲.mp3" id="barSound" style="display:none;"></audio>

        <!-- 遊戲結束四個字 -->
        <audio controls src="/pinball-board/assets/遊戲結束四個字.mp3" id="finishGameSound" style="display:none;"></audio>

        <!-- 像乎準喔 -->
        <audio controls src="/pinball-board/assets/像乎準喔.mp3" id="focusOn" style="display:none;"></audio>

        <!-- 加油加油 -->
        <audio controls src="/pinball-board/assets/加油加油.mp3" id="cheerUp" style="display:none;"></audio>

        <!-- 加油喔 -->
        <audio controls src="/pinball-board/assets/加油喔-台語.mp3" id="cheerUpTai" style="display:none;"></audio>

        <!-- price ring sounds -->
        <audio controls src="/pinball-board/assets/priceRingSound.mp3" id="priceRingSound"
          style="display:none;"></audio>

        <!-- 90 points price sound -->
        <audio controls src="/pinball-board/assets/90pointSound.mp3" id="nityPointSound" style="display:none;"></audio>

        <!-- 計算開機次數 -->
        <div class="" id="bootNumber"></div>
        <!-- 計算開機次數 ends-->
        <!-- audio end -->

        <!-- result_detail -->
        <input type="text" class="form_control" id="result_detail" style="display:none;">

        <!-- show internet speed -->
        <p id="progress" style="display:none;">JavaScript is turned off, or your browser is realllllly slow</p>

        <!-- quality input -->
        <input type="text" id="quality" value="30" style="display:none;">
      </div>
      <!-- drag -->

    </div>
    <!-- scroller -->



    </div>
    <!-- container -->



    
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.js"
        integrity="sha512-UOJe4paV6hYWBnS0c9GnIRH8PLm2nFK22uhfAvsTIqd3uwnWsVri1OPn5fJYdLtGY3wB11LGHJ4yPU1WFJeBYQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/wnumb/1.2.0/wNumb.min.js"
        integrity="sha512-igVQ7hyQVijOUlfg3OmcTZLwYJIBXU63xL9RC12xBHNpmGJAktDnzl9Iw0J4yrSaQtDxTTVlwhY730vphoVqJQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  
      <script>


        // 獲取所有點燈的元素
        const lights = document.querySelectorAll('.pointLight');

        //在每一局的第一次得分就閃一次
        const pointAmount = document.getElementById('point');

        //開機音樂
        const bootMusic1_1 = document.getElementById('bootMusic1_1');
        const bootMusic1_2 = document.getElementById('bootMusic1_2');
        const bootMusic1_3 = document.getElementById('bootMusic1_3');
        const bootMusic2_1 = document.getElementById('bootMusic2_1');
        const bootMusic2_2 = document.getElementById('bootMusic2_2');
        const bootMusic2_3 = document.getElementById('bootMusic2_3');
        const bootMusic3_1 = document.getElementById('bootMusic3_1');
        const bootMusic3_2 = document.getElementById('bootMusic3_2');
        const bootMusic3_3 = document.getElementById('bootMusic3_3');

        //藍色閃爍
        const blueLight = document.getElementById('blueLight');

        //點擊開始遊戲，音樂和閃爍換成別種播放樣式
        const buttonStartGame = document.getElementById('button_start_game');
        const startButtonSvg = document.getElementById('startButtonSvg');
        const startMusic = document.getElementById('startMusic');

        //遊戲機資訊變數
        const buttonInsertCoin = document.getElementById('button_insert_coin');  //擊發
        const ticket = document.getElementById('ticket');
        const cointMusic = document.getElementById('cointMusic');
        const result_ball = document.querySelector('input[name="result_ball"]');
        const result_score = document.querySelector('input[name="result_score"]');
        let pointTimeTicket;
        let pointAmountNotZero;  //當pointAmountNotZero還大於0的時候


        //get price sound
        const priceRingSound = document.getElementById('priceRingSound');
        const nityPointSound = document.getElementById('nityPointSound');

        //打彈珠背景音樂
        const playMusic1 = document.getElementById('playMusic1');
        const playMusic2 = document.getElementById('playMusic2');

        //拉桿撞擊聲
        const barSound = document.getElementById('barSound');


        //遊戲結束四個字
        const finishGameSound = document.getElementById('finishGameSound');

        //每顆球分數
        const result_detail = document.getElementById('result_detail');
        const detailValue = result_detail.value;




        //press buttonInsertCoin to clean the pointTimeTicket
        // buttonInsertCoin.addEventListener('click', pointTimeTicketNone);
        // function pointTimeTicketNone() {
        //   pointTimeTicket = '';
        //   ticket.value = 0;

        // };




        function lightStartFlash() {
          // 逐個處理每個點燈元素
          lights.forEach((light, index) => {
            const randomDelay = Math.floor(Math.random() * (1000 - 400 + 1)) + 400;

            // 設定 pointLight-out1 的延遲時間
            const delay1 = randomDelay; //****這裡會有隨機閃燈的效果,但要解決延遲播放問題****

            setTimeout(() => {

              light.classList.add('pointLight-out1'); // 添加 pointLight-out1 class
            }, delay1);

            const delay2 = 5000; // pointLight-out2延遲5000毫秒再執行

            setTimeout(() => {
              light.classList.add('pointLight-out2');
            }, delay2);
          });
        }

        lightStartFlash();


        //當偵測到分數不等於0時，執行firstGetpoint，而且只執行一次
        // 在頁面載入完成後直接觸發

        //getResult()
        function handleResultScoreChange() {
          // 分數不是0也不是五的倍數

          if (Number(result_ball.value) === 0 && Number(result_score.value) % 5 !== 0 && Number(result_score.value) !== 0) {
            lights.forEach(function (item) {
              item.classList.remove('firstGetpoint', 'pointLight-out1', 'pointLight-out2', 'highlight', 'nothighlight');
              item.classList.add('nothighlight');
            });
            ticket.value = 0; //to visible ticket.value on the screen except for players
          } else if (Number(result_ball.value) === 0 && Number(result_score.value) % 5 === 0 && Number(result_score.value) !== 0) {

            //抓data-ticket的值
            const getPointId = document.getElementById(`pointLight${(result_score.value)}`);
            const ticketValue = getPointId.getAttribute('data-ticket');  //彩票值

            ticket.value = ticketValue;  //ticketValue有彩票值喔，但僅限於這個函式內
            pointTimeTicket = ticketValue; //將彩票數(ticketValue)傳出去全域

            setTimeout(function () {    //這裡加上清除所有動畫樣式

              lights.forEach(function (item) {
                //將"不是"得分的分數反灰
                if (item.id !== `pointLight${(result_score.value)}`) {
                  item.classList.remove('firstGetpoint', 'pointLight-out1', 'pointLight-out2', 'highlight', 'nothighlight', 'startlight');
                  item.classList.add('nothighlight');
                } else {
                  item.classList.remove('firstGetpoint', 'pointLight-out1', 'pointLight-out2', 'highlight', 'nothighlight', 'startlight');
                  item.classList.add('highlight');
                }
              });
            }, 1000);


          };
          //避免得分燈亮後，例如15分，按開始之後燈號沒重新跑          
          lights.forEach(function (item) {
            item.classList.remove('firstGetpoint', 'pointLight-out1', 'pointLight-out2', 'highlight', 'nothighlight', 'startlight');
            item.classList.add('nothighlight');
          });

        }

        //按開機鈕自動播放
        const pressBoot = document.getElementById('pressBoot');
        const countdownElement = document.getElementById('result_ball');  //球數那欄顯示倒數秒數
        let bootNumber = 0;  //計算開機次數

        pressBoot.addEventListener('click', function () {
          //倒數
          let countdown = 3;
          const countdownInterval = setInterval(function () {
            //將倒數加到球數的input內
            countdownElement.value = countdown;
            countdown--;

            if (countdown < 0) {
              clearInterval(countdownInterval);
              countdownElement.value = ''; // 隱藏倒數元素
              playBootMusic();  //插入playBootMusic功能

            }
          }, 1000); // 每秒更新一次倒數

        })


        //執行bootMusic1或2或3的功能
        function playBootMusic() {

          if (bootNumber % 3 === 1) {
            bootNumber++;  //這裡移動到此，每首歌可以正常輪序

            bootMusic1_1.play(); // 播放音樂1(有開頭)

            // 播放音樂(不含開頭)
            bootMusic1_1.onended = function () {
              bootMusic1_2.play();
            };

            //bootMusic1_2再播放一次
            bootMusic1_2.onended = function () {
              bootMusic1_3.play();  //等同於不含開頭音樂播放兩次
              //播完音樂後開機次數加上一次，蓋掉最前面的bootNumber變數
              document.getElementById('bootNumber').textContent = bootNumber;  //顯示開機次數
            };

          } else if (bootNumber % 3 === 2) {
            bootMusic2_1.play(); // 播放音樂1(有開頭)

            // 播放音樂(不含開頭)
            bootMusic2_1.onended = function () {
              bootMusic2_2.play();
            };

            //bootMusic1_2再播放一次
            bootMusic2_2.onended = function () {
              bootMusic2_3.play();  //等同於不含開頭音樂播放兩次
              //播完音樂後開機次數加上一次，蓋掉最前面的bootNumber變數
              bootNumber++;
              document.getElementById('bootNumber').textContent = bootNumber;  //顯示開機次數
            };
          } else if (bootNumber % 3 === 0) {
            bootMusic3_1.play(); // 播放音樂1(有開頭)

            // 播放音樂(不含開頭)
            bootMusic3_1.onended = function () {
              bootMusic3_2.play();
            };

            //bootMusic1_2再播放一次
            bootMusic3_2.onended = function () {
              bootMusic3_3.play();  //等同於不含開頭音樂播放兩次
              //播完音樂後開機次數加上一次，蓋掉最前面的bootNumber變數
              bootNumber++;
              document.getElementById('bootNumber').textContent = bootNumber;  //顯示開機次數
            };
          }

        }



        //每按投幣一次，局數+1

        //   buttonInsertCoin.addEventListener('click', function () {
        //   cointMusic.play();  //播放投幣音樂
        //   // coinCount++;
        //   // pointAmount.value = coinCount; //增加投幣次數
        //   pointAmount.value++; //增加投幣次數
        //   console.log(`投幣之後的遊戲局數${pointAmount.value}`);
        // });

        //投幣鍵刪除，每按開始局數+1 **和下面監聽整合
        buttonStartGame.addEventListener('click', function () {
          cointMusic.play();  //播放投幣音樂
          // coinCount++;
          // pointAmount.value = coinCount; //增加投幣次數
          pointAmount.value++; //增加投幣次數
          console.log(`投幣之後的遊戲局數${pointAmount.value}`);
        });

        //result_ball每歸零一次，局數-1

        function setPointAmount() {

          //歸零條件:球數為0，按開始按鍵之後，局數還有剩，遊戲結束音效播放完才歸零
          if (Number(result_ball.value) === 0 && pointAmount.value > 0 && Number(result_ball.value) % 5 === 0) {
            //和上面的coinCount記憶體空間不同

            pointAmountNotZero = pointAmount.value;
            //播放中獎音樂 & 暫停背景音樂
            priceRingSound.play();
            playMusic1.pause();
            playMusic2.pause();
            // pointAmount.value = pointAmount.value - coinCount;
            pointAmount.value = 0;
            console.log(`條件式內的遊戲局數${pointAmount.value}`);
            //播放中獎音樂 & 暫停背景音樂            
            finishGameSound.play();  //遊戲結束四個字播放
            console.log("pointAmount歸零且播放遊戲結束");
            // coinCount = 0; //put here is most suitable, because pointAmount.value is already been minusified
            return;
          } else if (Number(result_ball.value) === 0 && pointAmount.value > 0 && Number(result_ball.value) % 5 !== 0) {
            // pointAmount.value = pointAmount.value - coinCount;
            pointAmount.value = 0;
            //沒有播放中獎音樂 & 暫停背景音樂
            playMusic1.pause();
            playMusic2.pause();
            finishGameSound.play();
            ticket.value = 0; //to avoid the next play show the ticket number last time
            // coinCount = 0;
            return;
          } else {
            console.log("pointAmount沒有歸零");
          };
        }


        function watchStart() {
          //有分數就不要閃爍開始燈，沒分數再閃鑠開始燈
          if (Number(result_ball.value) !== 0) {
            startButtonSvg.classList.remove('shinning', 'notshinning');
            startButtonSvg.classList.add('notshinning');
          } else if (Number(result_ball.value) === 0) {
            startButtonSvg.classList.remove('shinning', 'notshinning');
            startButtonSvg.classList.add('shinning');
          };
        };


        buttonStartGame.addEventListener('click', function () {

          //點擊開始後彩票數歸零 & 按開始後將只有亮燈號分數的狀態取消
          // setTimeout(function () {
          //   ticket.value = 0;
          // }, 2000);  //等候三秒再執行，就不會受到result_score影響

          // 暫停和歸零 開機音樂 的效果
          bootMusic1_1.pause();
          bootMusic1_2.pause();
          bootMusic1_3.pause();
          bootMusic2_1.pause();
          bootMusic2_2.pause();
          bootMusic2_3.pause();
          bootMusic3_1.pause();
          bootMusic3_2.pause();
          bootMusic3_3.pause();

          startMusic.play();   //播放開始音樂

          //開始後，自動播放打彈珠時的背景音樂1
          startMusic.onended = function () {
            startMusic.currentTime = 0;
            playMusic1.play();
          };

          //背景音樂2
          playMusic1.onended = function () {
            playMusic1.currentTime = 0;
            playMusic2.play();
          }
          //連續播放背景音樂2
          playMusic2.onended = function () {
            playMusic2.currentTime = 0;
            playMusic2.play();
          }

          // 點擊開始:閃爍燈號樣式
          //先清除原有燈號樣式
          lights.forEach(function (item) {
            item.classList.remove('firstGetpoint', 'pointLight-out1', 'pointLight-out2', 'highlight', 'startlight', 'nothighlight'); //加這一行，其他動畫不會繼續跑出來
            void item.offsetWidth;  //加上這一行強制重新整理，避免startlight沒移除
            item.classList.add('startlight');
          })

        })


        //拉桿            
        // const bar = document.getElementById('button_play_game');  //更改

        // const barImgLong = document.getElementById('barImgLong');
        // const barImgShort = document.getElementById('barImgShort');

        // buttonInsertCoin.addEventListener('click', function () {

        //   //拉桿縮放
        //   barImgLong.style.display = 'block';
        //   setInterval(function () {
        //     barImgLong.style.display = 'none';
        //     barImgShort.style.display = 'block';
        //   }, 600);
        //   barImgShort.style.display = 'none';

        //   //撥放拉桿聲音
        //   barSound.play();

        // })



        //關機(待改正)
        const pressShutdown = document.getElementById('pressShutdown');
        pressShutdown.addEventListener('click', function () {
          // 暫停或清除音樂播放器
          bootMusic1_1.pause();
          bootMusic1_2.pause();
          bootMusic1_3.pause();
          bootMusic2_1.pause();
          bootMusic2_2.pause();
          bootMusic2_3.pause();
          bootMusic3_1.pause();
          bootMusic3_2.pause();
          bootMusic3_3.pause();
          startMusic.pause();
          playMusic1.pause();
          playMusic2.pause();

          // 清除計時器
          clearInterval(countdownInterval);

          // 重置倒數元素
          countdownElement.value = '';

          // 清除點燈動畫效果
          lights.forEach(function (item) {

            item.classList.remove('firstGetpoint', 'pointLight-out1', 'pointLight-out2', 'highlight', 'startlight', 'darken', 'nothighlight', 'mouseFlash');
            item.style.animation = 'none';
            void item.offsetWidth; // 強制重新繪製，使上面的樣式生效
          });

        })


        //拉桿-手機震動       
        // 手機點擊時震動 400 毫秒 button_insert_coin擊發
        //buttonInsertCoin.addEventListener("click", function () {
        //navigator.vibrate(400);
        //barSound.play();
        //});



        //download the image to detect the internet speed
        //JUST AN EXAMPLE, PLEASE USE YOUR OWN PICTURE!
        // let speedMbps;

        // function downloadImage() {
        //   const imageAddr = "https://upload.wikimedia.org/wikipedia/commons/a/a6/Brandenburger_Tor_abends.jpg";
        //   const downloadSize = 2707459; // this must match with the image above
        //   // 全局變量，將用於存儲 speedMbps 的值
        //   function ShowProgressMessage(msg) {
        //     if (console) {
        //       if (typeof msg == "string") {
        //         console.log(msg);
        //       } else {
        //         for (let i = 0; i < msg.length; i++) {
        //           console.log(msg[i]);
        //         }
        //       }
        //     }

        //     const oProgress = document.getElementById("progress");
        //     if (oProgress) {
        //       let actualHTML = (typeof msg == "string") ? msg : msg.join("<br />");
        //       oProgress.innerHTML = actualHTML;
        //     }
        //   }

        //   function InitiateSpeedDetection() {
        //     ShowProgressMessage("Loading the image, please wait...");
        //     window.setTimeout(MeasureConnectionSpeed, 1);
        //   };

        //   if (window.addEventListener) {
        //     window.addEventListener('load', InitiateSpeedDetection, false);
        //   } else if (window.attachEvent) {
        //     window.attachEvent('onload', InitiateSpeedDetection);
        //   }

        //   function MeasureConnectionSpeed() {
        //     let startTime, endTime;
        //     let download = new Image();
        //     download.onload = function () {
        //       endTime = (new Date()).getTime();
        //       showResults();
        //     }

        //     download.onerror = function (err, msg) {
        //       ShowProgressMessage("Invalid image, or error downloading");
        //     }

        //     startTime = (new Date()).getTime();
        //     let cacheBuster = "?nnn=" + startTime;
        //     download.src = imageAddr + cacheBuster;

        //     function showResults() {
        //       let duration = (endTime - startTime) / 1000;
        //       let bitsLoaded = downloadSize * 8;
        //       let speedBps = (bitsLoaded / duration).toFixed(2);
        //       let speedKbps = (speedBps / 1024).toFixed(2);
        //       speedMbps = (speedKbps / 1024).toFixed(2);  //global to get the speedMbps 
        //       ShowProgressMessage([
        //         "Your connection speed is:",
        //         speedBps + " bps",
        //         speedKbps + " kbps",
        //         speedMbps + " Mbps"
        //       ]);

        //     }
        //   }

        // };

        //noUiSlider package
        const sliderFormat = document.getElementById('slider-format');

        noUiSlider.create(sliderFormat, {
          start: [0.1],  //start number
          step: 0.01,    //每次滑動間隔
          connect: 'lower',  //add to get a background color
          range: {
            'min': [0.1],
            'max': [1.5]
          },
          format: wNumb({
            decimals: 2,   //slide number
            // thousand: '.',
            suffix: ''  //to add a unit or word behind the words
          })
        });

        let inputFormat = document.getElementById('input-format');

        sliderFormat.noUiSlider.on('update', function (values, handle) {
          inputFormat.value = values[handle];
          if (inputFormat.value > 0.50) {
            $('.noUi-connect').css("background-color", "#ff7707");
          } else {
            $('.noUi-connect').css("background-color", "#3FB8AF");
          }
        });

        inputFormat.addEventListener('change', function () {
          sliderFormat.noUiSlider.set(this.value);
        });


        //Voice to text
        function speekToVoice() {
          const numbersString = result_detail.value; //"2;3;6;11;17;"
          const numbersArray = numbersString
            .split(";")
            .filter((num) => num !== "")
            .map((num) => parseInt(num));
          console.log(numbersArray); //[2, 3, 6, 11, 17]

          //get the lastnumber
          const lastNumber = numbersArray[numbersArray.length - 1];

          const synth = window.speechSynthesis;

          const utter = new SpeechSynthesisUtterance();
          // utter.text = numbersArray.join(" ");
          utter.text = lastNumber;

          // define speak
          function speak() {
            //change utter to voice
            synth.speak(utter);
            console.log(`${result_detail.value}`);
          }
        };

        result_detail.addEventListener("change", speekToVoice);  //it is very strange


        //Script to Actions
        let test_script = '### Example' + '\r' +
          'INSERTCOIN 1' + '\r' +
          'START' + '\r' +
          'LOOP1:' + '\r' +
          'PULL 2.0' + '\r' +
          'STOP 0.5' + '\r' +
          'SHOOT' + '\r' +
          'STOP 10' + '\r' +
          'IF BALL > 0 GOTO LOOP1 ELSE GOTO LOOP2' + '\r' +
          'STOP 10' + '\r' +
          'PULL 1.0' + '\r' +
          'SHOOT' + '\r' +
          'LOOP2:' + '\r' +
          'STOP 1' + '\r' +
          'SHOOT' + '\r' +
          'STOP 10' + '\r'
        'SHOOT' + '\r';

        document.getElementById('script_editor').value = test_script;

        // 如果成功了就執行setTImeout(resolve, ms)
        function sleep(ms) {
          return new Promise((resolve) => {
            setTimeout(resolve, ms);
          });
        }

        function myRandomNumber(min, max) {
          return (Math.floor(Math.random() * (max * 10 - min * 10 + 1)) + min * 10) / 10;
        };

        function parseCommandToken(tokens, index, execute, script_execution_counter, labels) {

          if (tokens != null && tokens.length > index) {

            if (tokens[index] === 'insertcoin') {

              if (tokens.length > index + 1) coins = tokens[index + 1]
              myLog("-> LINE " + script_execution_counter + " Command insertcoin" + " " + coins)
              if (execute) {
                insertCoin()
                itimer = 0
              }
              return [true, 2, 0, 0]
            }

            if (tokens[index] === 'start') {
              myLog("-> LINE " + script_execution_counter + " Command start")
              if (execute) {
                startGame()
                itimer = 0
              }
              return [true, 1, 0, 0]
            }

            if (tokens[index] === 'pull') {
              if (tokens.length > index + 1) sec = tokens[index + 1]
              myLog("-> LINE " + script_execution_counter + " Command pull" + " " + sec)
              if (execute) {
                gameActionPull(sec)
                itimer = 0
                return [true, 2, 0, sec]
              }
              return [true, 2, 0, 0]
            }


            if (tokens[index] === 'randpull') {
              if (tokens.length > index + 1) sec1 = tokens[index + 1]
              if (tokens.length > index + 2) sec2 = tokens[index + 2]
              myLog("-> LINE " + script_execution_counter + " Command randpull" + " " + sec1 + " " + sec2)
              sec = myRandomNumber(sec1, sec2)
              if (execute) {
                gameActionPull(sec)
                itimer = 0
                return [true, 3, 0, sec]
              }
              return [true, 3, 0, 0]
            }


            if (tokens[index] === 'shoot') {
              myLog("-> LINE " + script_execution_counter + " Command shoot")
              if (execute) {
                gameActionShoot()
                itimer = 0
              }
              return [true, 1, 0, 0]
            }


            if (tokens[index] === 'stop') {
              if (tokens.length > index + 1) sec = tokens[index + 1]
              myLog("-> LINE " + script_execution_counter + " Command stop" + " " + sec)
              if (execute) return [true, 2, 0, sec]
              else return [true, 2, 0, 0]
            }


            if (tokens[index] === 'randstop') {
              if (tokens.length > index + 2) {
                sec1 = tokens[index + 1]
                sec2 = tokens[index + 2]
              }
              myLog("-> LINE " + script_execution_counter + " Command randstop" + " " + sec1 + " " + sec2)
              if (execute) {
                sec = myRandomNumber(sec1, sec2)
                itimer = 0
                return [true, 3, 0, sec]
              }
              else return [true, 3, 0, 0]
            }


            if (tokens[index] === 'goto') {
              if (tokens.length > index + 1) label = tokens[index + 1]
              myLog("-> LINE " + script_execution_counter + " Command goto" + " " + label)
              new_script_execution_counter = 0
              if (execute) new_script_execution_counter = labels[label]
              return [true, 2, new_script_execution_counter, 0]
            }
          }
          return [false, 0, 0, 0]
        }


        function parseConditionToken(i, o, v, script_execution_counter) {

          let value1 = 0
          let value2 = 0
          let operator = o
          result = false
          //console.log("parseConditionToken"+JSON.stringify(result_data))
          if (i.indexOf('hole') > -1) {
            myLog("-> LINE " + script_execution_counter + " Condition " + i + " " + o + " " + v)
            value1 = i.replace('hole_', '')
            detail = result_data.data.detail
            detail_array = detail.split(';')
            //console.log("value 1 = "+value1 +" "+JSON.stringify(detail_array))
            found = false
            for (item in detail_array) {
              if (value1 === detail_array[item]) {
                found = true
                break
              }
            }
            if (v === 'on') if (found) result = true
            else if (v === 'off') if (!found) result = true
            operator = '<>'
          }
          else if (i === 'ball') {
            myLog("-> LINE " + script_execution_counter + " Condition " + i + " " + o + " " + v)
            value1 = 5 - result_data.data.ball
            value2 = parseInt(v)
            if (value1 < 0) result = false
            myLog("v1 = " + value1 + " v2 = " + value2)
          }

          else if (i === 'wball') {
            myLog("-> LINE " + script_execution_counter + " Condition " + i + " " + o + " " + v)
            value1 = result_data.data.ball_line
            value2 = parseInt(v)
            if (value1 < 0) result = false
            myLog("v1 = " + value1 + " v2 = " + value2)
          }


          else if (i === 'score') {
            myLog("-> LINE " + script_execution_counter + " Condition " + i + " " + o + " " + v)
            value1 = result_data.data.score
            value2 = parseInt(v)
          }


          else if (i === 'itimer') {
            myLog("-> LINE " + script_execution_counter + " Condition " + i + " " + o + " " + v)
            value1 = itimer
            value2 = parseInt(v)
          }




          switch (operator) {
            case '==':
              if (value1 === value2) result = true
              else result = false
              break
            case '!=':
              if (value1 !== value2) result = true
              else result = false
              break
            case '>':
              if (value1 > value2) result = true
              else result = false
              break
            case '>=':
              if (value1 >= value2) result = true
              else result = false
              break
            case '<':
              if (value1 < value2) result = true
              else result = false
              break
            case '<=':
              if (value1 <= value2) result = true
              else result = false
              break

          }
          myLog("Condition Result = " + result)
          return result
        }



        function action_script_runner_init(script_line) {
          lines = script_line.split(/\r?\n/)
          console.log(lines)
          script_timer = 0
          script_execution_counter = 0
          script_line_count = lines.length
          labels = {}
          console.log('Script Start , Line Count = ' + script_line_count)
          for (var i = 0; i < script_line_count; i++) {
            line = lines[i]
            line = line.trim()
            line = line.toLowerCase()
            if (line.indexOf(':') > -1) {
              label = line.substring(0, line.indexOf(':'))
              labels[label] = i
              console.log("Label " + i + " " + label)
            }
          }
          console.log("Labels :" + JSON.stringify(labels))
          itimer = 0
        }

        function action_script_runner_run(script_execution_counter_running) {

          if (script_execution_counter_running < script_line_count) {

            script_timeout = SCRIPT_DEFAULT_TIMEOUT


            line = lines[script_execution_counter_running];

            line = line.trim()
            line = line.toLowerCase()
            script_execution_counter_goto = 0
            if (line != '') {
              tokens = line.split(' ')
              condition_result = true
              condition_and = false
              condition_or = false
              condition_else = false
              for (var i = 0; i < tokens.length; i++) {
                console.log('' + tokens[i] + ' ')
                if (tokens[i].indexOf('#') == 0) {



                  myLog("-> LINE " + script_execution_counter_running + " Comment")

                  break
                }


                if (tokens[i].indexOf(':') > -1) {
                  myLog("-> LINE " + script_execution_counter_running + " Label")
                  break
                }

                result = parseCommandToken(tokens, i, condition_result || condition_else, script_execution_counter_running, labels)


                if (result[0]) {
                  i = i + result[1]
                  if (result[2] != 0) script_execution_counter_goto = result[2]
                  if (condition_result || condition_else) {
                    script_timeout = result[3]
                    break
                  }

                }

                if (tokens[i] === 'if') {

                  condition_result = false
                  myLog("-> LINE " + script_execution_counter_running + " IF ")
                  if (tokens.length > 4) {
                    condition_result = parseConditionToken(tokens[i + 1], tokens[i + 2], tokens[i + 3], script_execution_counter_running)
                  }
                  i = 3
                }


                if (tokens[i] === 'else') {

                  condition_else = true
                  myLog("-> LINE " + script_execution_counter + " ELSE ")
                }



                if (tokens[i] === '&&') {
                  myLog("-> LINE " + script_execution_counter_running + " && ")
                  if (tokens.length > i + 3) {
                    new_condition_result = parseConditionToken(tokens[i + 1], tokens[i + 2], tokens[i + 3], script_execution_counter_running)
                    condition_result = condition_result && new_condition_result
                  }
                  i += 3
                  condition_and = true
                }


                if (tokens[i] === '||') {
                  myLog("-> LINE " + script_execution_counter_running + " || ")
                  if (tokens.length > i + 3) {
                    condition_result ||= parseConditionToken(tokens[i + 1], tokens[i + 2], tokens[i + 3], script_execution_counter_running)
                  }
                  i += 3
                  condition_or = true
                }

                // Only one chain allowed for '&&' or '||'
                if (condition_and && condition_or) break

              }
            }

            if (script_execution_counter_goto == 0) {
              next_script_execution_counter_running = script_execution_counter_running + 1
            }
            else {
              next_script_execution_counter_running = script_execution_counter_goto
            }
            itimer = itimer + script_timeout

            //await sleep(script_timeout*1000);
            return next_script_execution_counter_running
          }
          myLog('>>>Script End')
          return -1
        }

        async function runrun(x) {
          y = action_script_runner_run(x)
          await sleep(script_timeout * 1000)
          return y
        }


        async function script_run_main(n) {
          x = n
          while (x < script_line_count) {
            await runrun(x)
            x = y
            if (script_stop) {
              script_execution_counter = x
              break
            }
          }
          if (x == script_line_count) myLog("<<< Script End >>>")
        }



        //script test API
        function insertCointest() {
          return new Promise((resolve, reject) => {
            $.ajax({
              url: BIZLUTION_RESTFUL_API_URL + 'insert_coin',
              success: function (result) {
                resolve(result);
              },
              error: function (error) {
                reject(error);
              }
            });
          });
        }

        function startGametest() {
          return new Promise((resolve, reject) => {
            $.ajax({
              url: BIZLUTION_RESTFUL_API_URL + 'start_game',
              success: function (result) {
                resolve(result);
              },
              error: function (error) {
                reject(error);
              }
            });
          });
        }

        function gameActionPull20test() {
          return new Promise((resolve, reject) => {
            $.ajax({
              url: BIZLUTION_RESTFUL_API_URL + 'game_action_pull?sec=' + 2.0,
              success: function (result) {
                resolve(result);
              },
              error: function (error) {
                reject(error);
              }
            })
          })
        }

        function gameActionShoottest() {
          return new Promise((resolve, reject) => {
            $.ajax({
              url: BIZLUTION_RESTFUL_API_URL + 'game_action_shoot',
              success: function (result) {
                resolve(result);
              },
              error: function (error) {
                reject(error);
              }
            });
          });
        }




        //ajax
        const BIZLUTION_RESTFUL_API_URL = "https://bizlution.pingguoxingren.com:60081/pinball/"
        $(document).ready(function () {

          //擊發歸零
          function insertCoin() {
            $.ajax({
              url: BIZLUTION_RESTFUL_API_URL + 'insert_coin',
              async: false,
              error: function (result) {
              },
              success: function (result) {

              }
            })
          }


          function startGame() {
            $.ajax({
              url: BIZLUTION_RESTFUL_API_URL + 'start_game',
              async: false,
              error: function (result) {
              },
              success: function (result) {

              }
            })
          }


          //拉桿 id="sec"
          function gameActionPull() {
            let sec = $("#sec").val()
            $.ajax({
              url: BIZLUTION_RESTFUL_API_URL + 'game_action_pull?sec=' + sec,
              async: false,
              error: function (result) {
              },
              success: function (result) {

              }
            })
          }

          //add myself pull range
          function gameActionPull04() {
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_pull?sec=0.4',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 500)
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_shoot',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 1000);
          }



          function gameActionPull05() {
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_pull?sec=0.5',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 500)
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_shoot',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 1100);
          }

          function gameActionPull06() {
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_pull?sec=0.6',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 500)
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_shoot',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 1200);
          }

          function gameActionPull07() {
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_pull?sec=0.7',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 500)
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_shoot',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 1300);
          }

          function gameActionPull08() {
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_pull?sec=0.8',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 500)
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_shoot',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 1400);
          }

          function gameActionPull09() {
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_pull?sec=0.9',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 500)
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_shoot',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 1500);
          }


          function gameActionPull10() {
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_pull?sec=1',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 500)
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_shoot',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 1600);
          }

          function gameActionPull11() {
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_pull?sec=1.1',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 500)
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_shoot',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 1700);
          }

          function gameActionPull12() {
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_pull?sec=1.2',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 500)
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_shoot',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 1800);
          }


          function gameActionPull13() {
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_pull?sec=1.3',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 500)
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_shoot',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 1900);
          }

          function gameActionPull14() {
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_pull?sec=1.4',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 500)
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_shoot',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 2000);
          }

          function gameActionPull15() {
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_pull?sec=1.5',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 500)
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_shoot',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, 2100);
          }



          //input-format
          function barMoveShoot() {
            let noUiHandle = $(".noUi-handle").attr("aria-valuenow");
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_pull?sec=' + noUiHandle,
                async: false,
                error: function (result) {
                },
                success: function (result) {

                }
              })
            }, 300);

            let delayValue = Number($(".noUi-handle").attr("aria-valuenow") * 1000) + 400;
            setTimeout(function () {
              $.ajax({
                url: BIZLUTION_RESTFUL_API_URL + 'game_action_shoot',
                async: false,
                error: function (result) {
                },
                success: function (result) {
                }
              })
            }, delayValue);
          }


          function gameActionShoot() {
            $.ajax({
              url: BIZLUTION_RESTFUL_API_URL + 'game_action_shoot',
              async: false,
              error: function (result) {
              },
              success: function (result) {

              }
            })
          }


          function gameActionShortcut(shortcut) {

            $.ajax({
              url: BIZLUTION_RESTFUL_API_URL + 'game_action_shortcut?shortcut=' + shortcut,
              async: false,
              error: function (result) {
              },
              success: function (result) {

              }
            })
          }

          //add setQuality
          function setQuality() {
            let q = $("#quality").val()
            $.ajax({
              url: BIZLUTION_RESTFUL_API_URL + 'set_quality?q=' + q,
              async: false,
              error: function (result) {
              },
              success: function (result) {

              }
            })
          }

          //internet speed detect API
          // function speedToQuality() {
          //   if (speedMbps >= 0 && speedMbps <= 100) {
          //     $.ajax({
          //       url: BIZLUTION_RESTFUL_API_URL + 'set_quality?q=' + 30,
          //       async: false,
          //       error: function (result) {
          //       },
          //       success: function (result) {
          //         console.log(`speedMbps${speedMbps}`);
          //       }
          //     })
          //   } else if (speedMbps > 100 && speedMbps <= 200) {
          //     $.ajax({
          //       url: BIZLUTION_RESTFUL_API_URL + 'set_quality?q=' + 50,
          //       async: false,
          //       error: function (result) {
          //       },
          //       success: function (result) {
          //         console.log(`speedMbps${speedMbps}`);
          //       }
          //     })
          //   } else if (speedMbps > 200) {
          //     $.ajax({
          //       url: BIZLUTION_RESTFUL_API_URL + 'set_quality?q=' + 40,
          //       async: false,
          //       error: function (result) {
          //       },
          //       success: function (result) {
          //         console.log(`speedMbps${speedMbps}`);
          //       }
          //     })
          //   };
          // }



          //upload script
          function uploadScript() {
            $.ajax({
              url: BIZLUTION_RESTFUL_API_URL + 'upload_script',
              async: false,
              error: function (result) {
              },
              success: function (result) {

              }
            })
          }



          function getResult() {

            $.ajax({
              dataType: "json",
              url: BIZLUTION_RESTFUL_API_URL + 'get_result',
              async: true,
              error: function (result) {
                console.log("getResult false");
                $('#middleImg').css('display', 'none');
                $('#imgFalse').css('display', 'block');
              },
              success: function (result) {

                $('#result_score').val(result.data.score)
                $('#result_ball').val(result.data.ball)
                $('#result_detail').val(result.data.detail)

                //將球數內容改為:5-API的ball數量
                const remainingBalls = 5 - parseInt($('#result_ball').val());
                console.log(remainingBalls);
                document.getElementById('result_ball').value = remainingBalls;

                //得分球亮燈功能
                handleResultScoreChange();

              }
            })

          }



          //針對setPointAmount()功能製作一個ajax功能
          function getPointAmount() {
            $.ajax({
              dataType: "json",
              url: BIZLUTION_RESTFUL_API_URL + 'get_result',
              async: false,
              error: function (result) {
              },
              success: function (result) {

                $('#result_score').val(result.data.score)
                $('#result_ball').val(result.data.ball)
                $('#result_detail').val(result.data.detail)

                //將球數內容改為:5-API的ball數量
                const remainingBalls = 5 - parseInt($('#result_ball').val());
                console.log(remainingBalls);
                document.getElementById('result_ball').value = remainingBalls;

                setPointAmount();

                console.log("ajax內執行setPointAmount");

              }
            })
          }

          function watchStartNow() {
            $.ajax({
              dataType: "json",
              url: BIZLUTION_RESTFUL_API_URL + 'get_result',
              async: false,
              error: function (result) {
              },
              success: function (result) {

                $('#result_score').val(result.data.score)
                $('#result_ball').val(result.data.ball)
                // $('#result_detail').val(result.data.detail)

                //將球數內容改為:5-API的ball數量
                const remainingBalls = 5 - parseInt($('#result_ball').val());
                console.log(remainingBalls);
                document.getElementById('result_ball').value = remainingBalls;

                watchStart();   //開始按鈕shinning，放這裡只是為了要取數據

              }
            })
          }



          $('#button_insert_coin').on('click', function (event) {
            insertCoin()
          })

          $('#button_start_game').on('click', function (event) {
            startGame()
          })

          //pull range
          $('#button_game_action_pull').on('click', function (event) {
            gameActionPull()
          })

          $('#button_game_action_pull04').on('click', function (event) {
            gameActionPull04()
          })

          $('#button_game_action_pull05').on('click', function (event) {
            gameActionPull05()
          })

          $('#button_game_action_pull06').on('click', function (event) {
            gameActionPull06()
          })

          $('#button_game_action_pull07').on('click', function (event) {
            gameActionPull07()
          })

          $('#button_game_action_pull08').on('click', function (event) {
            gameActionPull08()
          })

          $('#button_game_action_pull09').on('click', function (event) {
            gameActionPull09()
          })

          $('#button_game_action_pull10').on('click', function (event) {
            gameActionPull10()
          })

          $('#button_game_action_pull11').on('click', function (event) {
            gameActionPull11()
          })

          $('#button_game_action_pull12').on('click', function (event) {
            gameActionPull12()
          })

          $('#button_game_action_shoot').on('click', function (event) {
            gameActionShoot()
          })


          $('#button_game_action_shortcut_1').on('click', function (event) {
            gameActionShortcut(1)
          })

          $('#button_game_action_shortcut_2').on('click', function (event) {
            gameActionShortcut(2)
          })

          //when mouseup it will pull& shoot
          $('#example').on('mouseup', function (event) {
            barMoveShoot();
          })

          //set quality 
          // $(document).ready(function () {
          //   downloadImage();
          //   setTimeout(speedToQuality, 3000);
          //   //if don't use setTimeout, speedToQuality cannot execute 
          // });

          //Open the other window
          function openNewWindow(url) {
            window.open(url, "_blank")
          }

          //Open script website
          $('#button_scripts').on('click', function (event) {
            openNewWindow(BIZLUTION_RESTFUL_API_URL + 'scripts')
          })

          //Upload script
          $('#button_upload_script').on('click', function (event) {
            openNewWindow(BIZLUTION_RESTFUL_API_URL + 'upload_script')
          })

          let timerId;
          let timerId2;
          let timerId3;

          // function foo() {
          //   getResult();  //handleResultScoreChange & textToVoice
          //   //later every two seconds excute the foo loop
          //   timerId = setTimeout(foo, 2000);
          //   console.log("執行foo");
          // };
          // foo(); //跟getResult有關系的: 亮分數燈 & 有彩票數

          function foo() {
            getResult();
            setTimeout(foo, 1000);
          }
          foo();


          function zoo() {
            getPointAmount();   //setPointAmount
            timerId3 = setTimeout(zoo, 1000);
            console.log("執行zoo");
          }  //跟getPointAmount有關係:遊戲結束音樂 & 按投幣後投幣鍵變成0

          function qoo() {
            watchStartNow();
            //500milliseconds can change shinning to notshinning faster
            timerId2 = setTimeout(qoo, 1000);
            console.log("執行qoo");
          };

          buttonStartGame.addEventListener("click", function () {
            // deplay 9 seconds to avoid the mistake points in the beginning.
            setTimeout(zoo, 9000);
            //不小心連點兩次開始，會先跑出遊戲結束
            qoo();
            console.log("執行qoo");
          });
          //投幣和開始間隔拉長
          //按開始鍵後不能投幣
          //拉桿觸發foo比較複雜
          function fooRemove() {
            clearTimeout(timerId);
            console.log("移除foo");
          };

          function zooRemove() {
            clearTimeout(timerId3);
            console.log("移除zoo");
          };


          // buttonInsertCoin.addEventListener("click", zooRemove);
          buttonInsertCoin.addEventListener("click", fooRemove);
        });


        // player
        window.player = new Player({ useWorker: true, webgl: 'auto', size: { width: 400, height: 480 } })
        var playerElement = document.getElementById('viewer')
        playerElement.appendChild(window.player.canvas)
        // Websocket
        var wsUri = window.location.protocol.replace(/http/, 'ws') + '//' + window.location.hostname + ':9000'
        //var wsUri ='ws://192.168.1.59:8000/stream/0'
        var wsUri = 'wss://bizlution.pingguoxingren.com:60082'
        //var wsUri = 'ws://192.168.1.59:9000'

        var ws = new WebSocket(wsUri)
        ws.binaryType = 'arraybuffer'
        ws.onopen = function (e) {
          console.log('Client connected')
          ws.onmessage = function (msg) {
            // decode stream
            window.player.decode(new Uint8Array(msg.data));
          }
        }
        ws.onclose = function (e) {
          console.log('Client disconnected')
        }




      </script>
</body>

</html>